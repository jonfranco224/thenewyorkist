---
import Layout from '../../components/Layout.astro'
// import Article from '../../components/Article.astro';
import { render } from 'astro:content'
import { getCollection } from 'astro:content';
import { formatReadableDate } from '../../lib/date'
import { estimateReadingTime } from '../../lib/reading-time'
import CardRowTall from '../../components/CardRowTall.astro';

// Generate all possible routes for blog posts
export async function getStaticPaths() {
  const posts = await getCollection('articles'); // Adjust collection name if needed
  return posts.map((post) => {
    return {
      params: { slug: post.slug },
      props: { post },
    };
  });
}

// Get the post object passed via props
const { post } = Astro.props;
const { Content } = await render(post);

// Get Related Posts
const allPosts = await getCollection("articles");

// Sort posts by date in descending order (newest first)
allPosts.sort((a, b) => {
  const dateA = new Date(a.data.date).getTime(); // Convert to timestamp
  const dateB = new Date(b.data.date).getTime(); // Convert to timestamp
  return dateA - dateB;
});
---

<Layout
  seo={{ 
    title: post?.data?.title,
    description: post?.data?.description,
    type: 'article',
    image: post?.data?.image
  }}
>
  <div class="mx-auto pt-8 md:pt-8 pb-5 flex flex-col md:flex-row max-w-[var(--content-width)] md:max-w-full">
    <div class="md:w-[70%] m-auto">
      <div class="relative ">
        <div class="border-b absolute w-[25%] top-[50%] h-[1px] z-[-1]"></div>
        <p class="small !leading-[1] italic bg-[var(--cream)] w-max ml-4 pl-2.5 pr-2.5">{post.data.category}</p>
      </div>
      
      <h1 class="pt-4 leading-[1.2] pb-8 max-w-[1000px] mx-auto">{post.data.title}</h1>
      <div class="border-t border-b mb-5 flex flex-col sm:flex-row justify-between md:items-center gap-5 md:gap-0 py-3">
        <div class="flex items-center ">
          <img class="w-[41px] md:w-[41px] h-[41px] md:h-[41px] object-cover rounded-full" src="https://res.cloudinary.com/ddpw0my3h/image/upload/v1736559312/Alistair_Graves_n8rlgz.webp" />
          <div class="pl-3 flex flex-col justify-center">
            <p class="text-[14px] md:text-[14px] leading-[1.2]">By {post.data.author}</p>
            <p class="text-[13px] opacity-[.75] leading-[1.2] pt-[2px]">{formatReadableDate(post.data.date)}</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <a class='group hover:bg-[var(--black)] border hover:border-[var(--black)] rounded-full w-[35px] h-[35px] flex justify-center items-center'>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15px" height="15px" viewBox="-5 0 20 20" version="1.1">
              <title>facebook [#176]</title>
              <desc>Created with Sketch.</desc>
              <defs>
              </defs>
              <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                  <g id="Dribbble-Light-Preview" transform="translate(-385.000000, -7399.000000)" class="group-hover:fill-[white]" fill="var(--black)">
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                        <path d="M335.821282,7259 L335.821282,7250 L338.553693,7250 L339,7246 L335.821282,7246 L335.821282,7244.052 C335.821282,7243.022 335.847593,7242 337.286884,7242 L338.744689,7242 L338.744689,7239.14 C338.744689,7239.097 337.492497,7239 336.225687,7239 C333.580004,7239 331.923407,7240.657 331.923407,7243.7 L331.923407,7246 L329,7246 L329,7250 L331.923407,7250 L331.923407,7259 L335.821282,7259 Z" id="facebook-[#176]">
                        </path>
                    </g>
                  </g>
              </g>
            </svg>
          </a>
          <a class='group hover:bg-[var(--black)] border hover:border-[var(--black)] rounded-full w-[35px] h-[35px] flex justify-center items-center'>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px" height="18px" viewBox="0 -2 20 20" version="1.1">
              <title>twitter [#154]</title>
              <desc>Created with Sketch.</desc>
              <defs>
              </defs>
              <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" class="group-hover:fill-[white]" fill="var(--black)">
                  <g id="icons" transform="translate(56.000000, 160.000000)">
                    <path d="M10.29,7377 C17.837,7377 21.965,7370.84365 21.965,7365.50546 C21.965,7365.33021 21.965,7365.15595 21.953,7364.98267 C22.756,7364.41163 23.449,7363.70276 24,7362.8915 C23.252,7363.21837 22.457,7363.433 21.644,7363.52751 C22.5,7363.02244 23.141,7362.2289 23.448,7361.2926 C22.642,7361.76321 21.761,7362.095 20.842,7362.27321 C19.288,7360.64674 16.689,7360.56798 15.036,7362.09796 C13.971,7363.08447 13.518,7364.55538 13.849,7365.95835 C10.55,7365.79492 7.476,7364.261 5.392,7361.73762 C4.303,7363.58363 4.86,7365.94457 6.663,7367.12996 C6.01,7367.11125 5.371,7366.93797 4.8,7366.62489 L4.8,7366.67608 C4.801,7368.5989 6.178,7370.2549 8.092,7370.63591 C7.488,7370.79836 6.854,7370.82199 6.24,7370.70483 C6.777,7372.35099 8.318,7373.47829 10.073,7373.51078 C8.62,7374.63513 6.825,7375.24554 4.977,7375.24358 C4.651,7375.24259 4.325,7375.22388 4,7375.18549 C5.877,7376.37088 8.06,7377 10.29,7376.99705" id="twitter-[#154]">
                    </path>
                  </g>
                </g>
              </g>
            </svg>
          </a>
          <a class='group hover:bg-[var(--black)] border hover:border-[var(--black)] rounded-full w-[35px] h-[35px] flex justify-center items-center'>
            <svg xmlns="http://www.w3.org/2000/svg" class="group-hover:fill-[white]" fill="var(--black)" width="19px" height="19px" viewBox="0 0 256 256" id="Flat">
            <path d="M248,104a31.99228,31.99228,0,0,0-52.9375-24.19043c-16.75439-8.90112-36.76172-14.279-57.666-15.52539l5.19581-31.17578,21.83105,3.3584a24.00409,24.00409,0,1,0,2.43506-15.814l-29.64209-4.56006a7.996,7.996,0,0,0-9.10742,6.5918l-6.91309,41.478c-21.83887.94165-42.813,6.37891-60.2583,15.647a31.99266,31.99266,0,0,0-42.59229,47.74024A59.04669,59.04669,0,0,0,16,144c0,21.93457,12.042,42.35156,33.90723,57.48926C70.875,216.00588,98.60938,224,128,224s57.125-7.99414,78.09277-22.51074C227.958,186.35158,240,165.93459,240,144a59.01726,59.01726,0,0,0-2.3457-16.44922A32.17163,32.17163,0,0,0,248,104ZM72,132a16,16,0,1,1,16,16A16.01833,16.01833,0,0,1,72,132Zm92.69629,51.10938a80.122,80.122,0,0,1-73.39209,0,8,8,0,0,1,7.34033-14.2168,64.09433,64.09433,0,0,0,58.71094,0,8.00008,8.00008,0,0,1,7.34082,14.2168ZM168,148a16,16,0,1,1,16-16A16.01833,16.01833,0,0,1,168,148Z"/>
            </svg>
          </a> 
        </div>
      </div>      
      
      <div class="pb-4 md:pb-5 aspect-video">
        <img 
          class="w-full object-cover overflow-hidden aspect-video" 
          src={post.data.image.src}
          alt={post.data.image.alt} />
        <small class="block pt-3 opacity-[.75]"><em>{post.data.image.alt}</em></small>
      </div>
      <div class="post-body border-b pb-5">
        <Content />
      </div>
      <div class="py-5 flex items-center gap-3 border-b">
        <p class="small">Tags</p>
        <button class="small px-4 py-1 border rounded-full">
          technology
        </button>
        <button class="small px-4 py-1 border rounded-full">
          local
        </button>
      </div>
    </div>
    <div class="w-[30%] flex flex-col pl-5 mx-auto lg:max-w-full border-l ml-5">
      <div class="flex-1 border-b hidden md:block ">
        <p class=" !leading-[1] mb-2">Related News</p>
        <section class="grid grid-cols-2 md:grid-cols-1 border-t">
          {
            [allPosts[0], allPosts[1], allPosts[2], allPosts[3]].map((post) => (
              <a
                href={`/articles/${post.slug}`}
                class="flex border-b py-3"
              >
                {/* <img
                  class="w-[25%] aspect-video lg:aspect-[7/5] object-cover overflow-hidden"
                  src={post.data.image.src}
                  alt={post.data.image.alt}
                /> */}
                <div class="w-[100%] flex flex-col justify-start pl-0">
                  <div class="flex items-start text-extra-small italic pb-2">
                    {post.data.category} <span class="inline-block text-[rgb(68,68,68)] px-2">|</span> By {post.data.author} 
                  </div>
                  <p class="title text-[16px] font-bold !leading-[1.3]">
                    {post.data.title}
                  </p>
                  <p class="text-[12px] leading-[1.4] text-[rgb(68,68,68)] pt-2">{post.data.description}</p>
                  
                </div>
              </a>
            ))
          }
        </section>
      </div>
    </div>
  </div>
  <div>
    <div class="max-w-[var(--content-width)] mx-auto border-t md:max-w-none">
      <CardRowTall title="More News" posts={allPosts} />
      <section class="bg-[var(--black)] py-10 px-4 text-center mb-5 mt-5">
        <p class="h4 !leading-[1.65] text-white m-auto">Readers like you support journalists like us. <br/> Please donate today.</p>
        <a href="/donate" class="hover:text-white border border-white bg-white hover:bg-transparent inline-block p block mt-3  !leading-[1.2] px-6 py-2 rounded-l-full rounded-r-full">
          Donate
        </a>
      </section>
    </div>
  </div>
  
  
</Layout>
